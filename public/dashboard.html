<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Garden - ?€?œë³´??/title>
    <link rel="stylesheet" href="../assets/css/style.css?v=2">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header>
            <a href="#" class="logo">Secret Garden</a>
            <button onclick="AuthService.logout()"
                style="border:none; background:none; color:#666; font-size:0.9rem; cursor:pointer;">ë¡œê·¸?„ì›ƒ</button>
        </header>

        <!-- Welcome Section -->
        <div class="p-4" style="background-color: var(--color-lemon);">
            <p style="margin: 0; font-size: 0.9rem; color: #666;" id="today-date">2023??00??00??/p>
            <h2 style="margin: 8px 0 0 0; color: #333;"><span id="user-name">ê°€ì¡?/span>??<br>?¤ëŠ˜???‰ë³µ?˜ì„¸?? ?˜Š</h2>
        </div>

        <!-- Menu Grid -->
        <div style="padding: 16px; display: grid; grid-template-columns: 1fr; gap: 8px;">

            <!-- Card 1: MBTI -->
            <div class="card" onclick="location.href='mbti/index.html'"
                style="border-left: 5px solid var(--color-coral);">
                <div class="card-title">?§© ê°€ì¡?MBTI ?ŒìŠ¤??/div>
                <div class="card-desc">?°ë¦¬ ê°€ì¡±ì˜ ?±ê²© ? í˜•???Œì•„ë³´ê³  ?œë¡œë¥??´í•´?´ë´??</div>
            </div>

            <!-- Card 2: Fortune -->
            <div class="card" onclick="location.href='fortune/index.html'"
                style="border-left: 5px solid var(--color-mint);">
                <div class="card-title">?? ?¤ëŠ˜??ê°€ì¡??´ì„¸</div>
                <div class="card-desc">?¤ëŠ˜???‰ìš´ ì»¬ëŸ¬?€ ì¡°ì–¸???•ì¸?´ë³´?¸ìš”.</div>
            </div>

            <!-- Card 3: Preference -->
            <div class="card" onclick="location.href='preference/index.html'"
                style="border-left: 5px solid var(--color-lavender);">
                <div class="card-title">?–ï¸ ì·¨í–¥ ë¶„ì„ê¸?/div>
                <div class="card-desc">ì§œì¥ vs ì§¬ë½•? ê°€ì¡±ë“¤??ì·¨í–¥ ê¶í•©???Œì•„ë³¼ê¹Œ??</div>
            </div>

        </div>

        <div style="flex-grow: 1;"></div> <!-- Spacer -->
    </div>

    <!-- Scripts -->
    <script src="../src/auth.js?v=3"></script>
    <script type="module">
        import '../src/firebase.js?v=6?v=3'; // Ensures Firebase is initialized

        // Logic executes after imports
        // 1. Init Check
        AuthService.checkAuth();

        // 2. Set Date
        const now = new Date();
        const days = ['??, '??, '??, '??, 'ëª?, 'ê¸?, '??];
        document.getElementById('today-date').innerText =
            `${now.getFullYear()}??${now.getMonth() + 1}??${now.getDate()}??(${days[now.getDay()]})`;

        // 3. User Name Logic (Robust)
        // Wait for auth state to confirm user info if session is empty
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                const storedName = sessionStorage.getItem('user_name');
                let displayName = 'ê°€ì¡?;

                if (storedName && storedName !== 'null') {
                    displayName = storedName;
                } else if (user.email) {
                    displayName = user.email.split('@')[0];
                    // Update session for next time
                    sessionStorage.setItem('user_email', user.email);
                    sessionStorage.setItem('user_name', displayName);
                }
                document.getElementById('user-name').innerText = displayName;
            }
        });
    </script>
</body>

</html>
