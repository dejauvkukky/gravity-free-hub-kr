<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Garden - ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="../assets/css/style.css?v=15">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header>
            <a href="#" class="logo">Secret Garden</a>
            <button onclick="AuthService.logout()"
                style="border:none; background:none; color:inherit; font-size:0.9rem; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
        </header>

        <!-- Welcome Section -->
        <div class="p-4" style="background-color: var(--color-bg); padding-bottom: 0;">
            <p style="margin: 0; font-size: 0.9rem; color: #666;" id="today-date">2023ë…„ 00ì›” 00ì¼</p>
            <h2 style="margin: 8px 0 0 0; color: var(--color-primary);"><span id="user-name">ê°€ì¡±</span>ë‹˜,<br>ì˜¤ëŠ˜ë„ í–‰ë³µí•˜ì„¸ìš”!
                ğŸ˜Š</h2>
        </div>

        <!-- Menu Grid -->
        <div style="padding: 16px; display: grid; grid-template-columns: 1fr; gap: 15px;">

            <!-- Card 1: MBTI -->
            <div class="card" onclick="location.href='mbti/index.html'"
                style="background: linear-gradient(135deg, #fff0f0 0%, #ffffff 100%); border: 1px solid #ffc9c9; margin:0; transition: transform 0.2s;">
                <div class="card-title" style="color: #e11d48;">ğŸ§© ê°€ì¡± MBTI í…ŒìŠ¤íŠ¸</div>
                <div class="card-desc">ìš°ë¦¬ ê°€ì¡±ì˜ ì„±ê²© ìœ í˜•ì„ ì•Œì•„ë³´ê³  ì„œë¡œë¥¼ ì´í•´í•´ë´ìš”!</div>
            </div>

            <!-- Card 2: Fortune -->
            <div class="card" onclick="location.href='fortune/index.html'"
                style="background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%); border: 1px solid #86efac; margin:0; transition: transform 0.2s;">
                <div class="card-title" style="color: #15803d;">ğŸ€ ì˜¤ëŠ˜ì˜ ê°€ì¡± ìš´ì„¸</div>
                <div class="card-desc">ì˜¤ëŠ˜ì˜ ë°”ì´ì˜¤ë¦¬ë“¬ê³¼ <strong>í¬ì¶˜ì¿ í‚¤ë¥¼ ê¸ì–´ë³´ì„¸ìš”!</strong> ğŸ¥ </div>
            </div>

            <!-- Card 3: Calendar -->
            <div class="card" onclick="location.href='calendar/index.html'"
                style="background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%); border: 1px solid #bfdbfe; margin:0; transition: transform 0.2s;">
                <div class="card-title" style="color: #1d4ed8;">ğŸ“… ê°€ì¡± ì¼ì •</div>
                <div class="card-desc">ìš°ë¦¬ ê°€ì¡±ì˜ ì¤‘ìš” í–‰ì‚¬ë¥¼ ë‹¬ë ¥ì— ê¸°ë¡í•´ìš”!</div>
            </div>

            <!-- Card 4: Preference (Hidden) -->
            <div class="card"
                style="border-left: 5px solid #ccc; margin:0; opacity: 0.7; cursor: default; display: none;">
                <div class="card-title">âš–ï¸ ì·¨í–¥ ë¶„ì„ê¸° (ì¤€ë¹„ì¤‘)</div>
                <div class="card-desc">ì§œì¥ vs ì§¬ë½•? ê°€ì¡±ë“¤ì˜ ì·¨í–¥ ê¶í•©ì„ ì•Œì•„ë³¼ê¹Œìš”?</div>
            </div>

        </div>

        <div style="flex-grow: 1;"></div> <!-- Spacer -->

        <div class="text-center p-4">
            <p style="font-size: 0.8rem; color: #888;">Â© Secret Garden V1.0</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../src/auth.js?v=7"></script>
    <script type="module">
        import '../src/firebase.js?v=7'; // Ensures Firebase is initialized

        // Logic executes after imports
        // 1. Init Check
        AuthService.checkAuth();

        // 2. Set Date
        const now = new Date();
        const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        document.getElementById('today-date').innerText =
            `${now.getFullYear()}ë…„ ${now.getMonth() + 1}ì›” ${now.getDate()}ì¼ (${days[now.getDay()]})`;

        // 3. User Name Logic (Robust)
        // Wait for auth state to confirm user info if session is empty
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                const storedName = sessionStorage.getItem('user_name');
                let displayName = 'ê°€ì¡±';

                if (storedName && storedName !== 'null') {
                    displayName = storedName;
                } else if (user.email) {
                    displayName = user.email.split('@')[0];
                    // Update session for next time
                    sessionStorage.setItem('user_email', user.email);
                    sessionStorage.setItem('user_name', displayName);
                }
                document.getElementById('user-name').innerText = displayName;
            }
        });
    </script>
</body>

</html>